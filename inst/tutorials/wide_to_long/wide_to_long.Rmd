---
title: "Smart Week 2"
author: "Christian Duenas"
date: "4/6/2021"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(learnr)

# Load in the datasets

root_dir <- dirname(dirname(dirname(getwd())))


load( paste0(root_dir, "/data/long.RData") )
load( paste0(root_dir, "/data/wide.RData") )
#load("ucrstats/data/long.RData")
```

# Converting Data from Wide To Long



## Introduction

In this tutorial, we'll be discussing the difference between wide data and long data. We'll also see how we can transition from wide to long using both the `tidyr` package as well as base R.

First, lets take a look at each format and how they differ.

## The Long Data Format

In the long format, the unit of analysis (i.e. height and weight) are separated into two separate variables and are therefore given their own column.

Each row represents a single time point per subject, so multiple responses for the same subject will be given their own row.

A long dataset will have more rows than its wide dataset counterpart, but will have less columns.

![Figure 1: A simple example of long data](images/long.png)



## The Wide Data Format

![Figure 2: A simple example of wide data](images/wide.png)

## Tidyverse Approach using tidyr


```{r tidyverse, exercise = TRUE}
library(tidyr)
wide %>% tidyr::pivot_longer( , names_to = c(), names_sep=) %>% 
  pivot_wider(names_from = , values_from = ) -> new_long 
```


```{r tidyverse-solution}
wide %>% tidyr::pivot_longer( `v1/mean`:`v4/median`, names_to = c("time","stat"), names_sep="/") %>% # pivot longer to separate vs from stat
  pivot_wider(names_from = stat, values_from = value) -> new_long # Recreate stats using pivot wider
```


## Base R Approach using `reshape`

```{r base_r, exercise = TRUE}

```


```{r base_r-solution}
# Covert using as.data.frame
in_data <- as.data.frame(wide) 
# Use reshape to covert from wide to long
to_long <- reshape(data = in_data, direction = "long", idvar = "ID1", sep ="/", v.names = c("mean", "sd", "median"), timevar = "time", times =c("v1", "v2", "v3", "v4"),
        varying = list(grep("mean", colnames(in_data), value=T), grep("sd", colnames(in_data), value=T), grep("median", colnames(in_data), value=T)))
# remove the rownames 
rownames(to_long) <- c()
# to_long

# to_long %>% filter(ID1 == "Ad9131ee9") # check
```

