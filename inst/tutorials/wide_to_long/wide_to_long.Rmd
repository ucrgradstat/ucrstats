---
title: "UCR Statistics"
author: "Christian Duenas"
date: "4/6/2021"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(learnr)

# Load in the datasets

root_dir <- dirname(dirname(dirname(getwd())))


load( paste0(root_dir, "/data/long.RData") )
load( paste0(root_dir, "/data/wide.RData") )
#load("ucrstats/data/long.RData")
```

# Converting Data from Wide To Long



## Introduction

In this tutorial, we'll be discussing the difference between wide data and long data. We'll also see how we can transition from wide to long using both the `tidyr` package as well as base R.

First, lets take a look at each format and how they differ.

## The Long Data Format

In the long format, the unit of analysis (for example, height and weight) are separated into separate variables and are therefore given their own column.

Each row represents a single time point per subject, so multiple responses for the same subject will be given their own row.

Because of this, data in the long format will generally have more rows than its wide format counterpart

Generally, most of the datasets you work with in R will be in the long format.

![Figure 1: A simple example of long data. Notice how a column exists to distinguish between the years](images/long.png)



## The Wide Data Format

In the wide format, a subjects repeated responses will be in a single row. This will "group" all of the categorical data according to the subject.

Because of this, data in the wide format will generally have less rows than its long format counterpart

![Figure 2: A simple example of wide data. Notice how the years are each given their own rows for each university](images/wide.png)

## Converting between formats

There may be certain situations where you are given a dataset, but need to convert it into a different format. This can be done using the `tidyr` package in R (which is part of the `tidyverse` collection), or by using the `reshape()` function in base R. 

This tutorial will detail how to transition wide data to long data, but you can also use these tools to transition from long data to wide.

We will make the following wide dataset named `wide` (which is shown below)

```{r}
wide
```

Into the long format where a column is used to keep track of the time period

```{r}
long
```


## Tidyverse Approach using tidyr

To use this approach, make sure you have the `tidyr` package installed (which comes bundled in with `tidyverse`).


```{r tidyverse, exercise = TRUE}
library(tidyr)
wide %>% tidyr::pivot_longer(cols= , names_to = c(), names_sep=) %>% 
  pivot_wider(names_from = , values_from = ) -> new_long 
```


```{r tidyverse-solution}
wide %>% tidyr::pivot_longer( `v1/mean`:`v4/median`, names_to = c("time","stat"), names_sep="/") %>% # pivot longer to separate vs from stat
  pivot_wider(names_from = stat, values_from = value) -> new_long # Recreate stats using pivot wider
```


## Base R Approach using `reshape`

```{r base_r, exercise = TRUE}
# Covert our table ot a dataframe using as.data.frame
in_data <- as.data.frame(wide) 

to_long <- reshape(data = in_data, direction = "long", idvar = "ID1", sep ="/", v.names = , 
                   timevar = "time", times =,
                   varying = list(grep(, colnames(in_data), value=T), grep(, colnames(in_data), value=T), grep(, colnames(in_data), value=T)))

to_long # Print the result
```


```{r base_r-solution}
# Covert using as.data.frame
in_data <- as.data.frame(wide) 
# Use reshape to covert from wide to long
to_long <- reshape(data = in_data, direction = "long", idvar = "ID1", sep ="/", v.names = c("mean", "sd", "median"), timevar = "time", times =c("v1", "v2", "v3", "v4"),
        varying = list(grep("mean", colnames(in_data), value=T), grep("sd", colnames(in_data), value=T), grep("median", colnames(in_data), value=T)))
# remove the rownames 
rownames(to_long) <- c()
```

